apply plugin: 'artifactory'

version = '1.6.0-SNAPSHOT'

ext {
    decimal = false
    dictDir = file("dicts/${release}")
}

archivesBaseName = "quickfixj-${release}"

// Change default project layout
sourceSets {
    main {
        java {
            srcDir 'src/gen/java'
        }
        resources {
            srcDir "${dictDir}"
        }
    }
}

eclipse {
    classpath {
        sourceSets -= [ sourceSets.test ]
    }
}

dependencies {
    if (incremental_build) {
        compile 'com.exactprosystems.testtools:apache-mina-core:2.0.9-SNAPSHOT'
        provided 'com.exactprosystems.testtools:quickfixj-code-generator:1.6.0-SNAPSHOT'
    } else {
        compile project(':BackEnd:apache-mina-core-2.0.9')
        provided project(':BackEnd:Quickfixj-1.6.0:quickfixj-codegenerator')
    }

    compile "org.slf4j:slf4j-api:${version_slf4j}"
    //Transitive dependencies should be enable for using JdbcStore
    compile group: 'com.cloudhopper.proxool', name: 'proxool', version: '0.9.1', transitive: false

    //compile 'org.apache.avalon.framework:avalon-framework-api:4.3.1'

    //Using for SleepycatStore
    compile 'berkeleydb:je:2.1.30'

    testCompile 'junit:junit:4.7'
    testCompile 'org.mockito:mockito-all:1.10.19'
    testCompile 'org.mockito:mockito-core:1.10.19'
    testCompile 'org.hamcrest:hamcrest-all:1.3'
    testCompile 'org.hsqldb:hsqldb:2.3.2'
}

jar {
    //classifier = "${release}"
    manifest {
        attributes("FIX-Project": "${release}")
    }
}

task generateMessage {
/*	if (!incremental_build) {
		dependsOn(':BackEnd:Quickfixj-1.6.0:quickfixj-codegenerator:assemble')
	}*/

    doLast {
        println "###############################################"
        println "Currency will be treated as BigDecimal = ${decimal}"
        println "###############################################"

        javaexec {
            classpath sourceSets.main.runtimeClasspath
            main 'org.quickfixj.codegenerator.MessageCodeGenerator'
            args = ["${dictDir}", './', 'src/gen/java']
            jvmArgs = ["-Dgenerator.decimal=${decimal}"]
        }
    }
}

compileJava.dependsOn.add('generateMessage')

clean {
    delete 'src/gen'
}

task zipDicts(type: Zip) {
    classifier = 'dicts'
    from ('dicts')
}

artifacts {
    archives(zipDicts)
}

test.enabled = false
compileTestJava.enabled = false